<div class=\"flex flex-col h-screen w-full max-w-full max-h-screen border-b border-gray-300 p-4\" hx-ext=\"ws\" ws-connect=\"
\"><div class=\"text-2xl font-bold\" id=\"chatUsername\">
</div><div class=\"p-4 space-y-4 max-h-full flex-grow\" id=\"chatMessages\"><div class=\"flex bg-gray-100 p-4 w-full h-full max-h-full max-w-full flex-grow \"><ul id=\"chat_room\" class=\"w-full h-full overflow-y-scroll\">
<div class=\"text-center justify-center text-2xl text-gray-500 mt-10\" id=\"noMessages\">No messages yet. Say hello!</div>
<li class=\"flex mt-4 justify-end bg-blue-100 p-3 rounder-lg shadow max-w-xs\"><div class=\"text-base font-bold mr-2 text-red-500\">
</div><div class=\"text-sm text-gray-800\">
</div><div class=\"text-xs text-gray-500 mt-1\">
</div></li>
 
<!-- Friend's message --> <li class=\"flex mt-4 justify-start bg-gray-100 p-3 rounded-lg shadow max-w-xs\"><div class=\"text-base font-bold mr-2 text-red-500\">
</div><div class=\"text-sm text-gray-800\">
</div><div class=\"text-xs text-gray-500 mt-1\">
</div></li>
</ul></div></div><!-- Input Bar --><div class=\"border-t border-gray-300 p-4 flex items-center\"><form id=\"chatForm\" class=\"w-full flex flex-grow\" ws-send autocomplete=\"off\">
<input type=\"hidden\" id=\"currentUserId\" name=\"currentUserId\" value=\"
\"><!-- Hidden input for user ID --><input type=\"hidden\" id=\"chat_id\" name=\"chat_id\" value=\"
\"> <input name=\"text\" id=\"chatInput\" type=\"text\" placeholder=\"Type a message...\" rows=\"2\" class=\"flex-grow p-3 border rounded-lg focus:outline-none focus:ring focus:border-blue-300 resize-none\"> <button id=\"sendButton\" type=\"submit\" class=\"ml-2 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 justify-end\">Send</button></form></div></div><script>\n\n\tconst currentUserId = document.getElementById('currentUserId').value; // Get current user ID\n\tconst chatId = document.getElementById(\"chat_id\").value; // Get the chat ID\n\tconst ws = new WebSocket(`ws://127.0.0.1:7331/ws?chat_id=${chatId}`);\n\n\t// WebSocket event handlers\n\tws.onopen = function () {\n\t\tconsole.log(\"WebSocket Connection Opened\");\n\t};\n\n\tws.onerror = function (error) {\n\t\tconsole.error(\"WebSocket Error:\", error);\n\t};\n\n\tws.onmessage = function (event) {\n\n\t\tevent.preventDefault();\n\n\t\tconst messageInput = document.getElementById('chatInput');\n\t\tconst messageText = messageInput.value;\n\n\t\tmessageInput.value = '';\n\n\t\tconst chatRoom = document.getElementById('chat_room');\n\t\tconst noMessagesElement = document.getElementById('noMessages');\n\n\t\t// Remove the \"No messages yet\" message if it exists\n\t\tif (noMessagesElement) {\n\t\t\tnoMessagesElement.classList.add('hidden');\n\t\t}\n\n\n\t\tconst message = JSON.parse(event.data);\n\t\tconsole.log(\"Received message:\", message);\n\t\t// appendMessageToChat(message);\n\t};\n\n\tws.onclose = function () {\n\t\tconsole.log(\"WebSocket Connection Closed\");\n\t\tconst chat_room = document.getElementById('chat_room');\n\t\tchat_room.innerHTML = '';\n\t};\n\n\t// Send a message through the WebSocket\n\tdocument.getElementById('chatForm').addEventListener('submit', function (event) {\n\t\tevent.preventDefault();\n\n\t\tconst messageInput = document.getElementById('chatInput');\n\t\tconst messageText = messageInput.value;\n\n\t\tif (messageText.trim() != \"\") {\n\t\t\tconst message = {\n\t\t\t\tchat_id: chatId,\n\t\t\t\tsender_id: currentUserId,\n\t\t\t\ttext: messageText\n\t\t\t};\n\n\t\t\tconsole.log(\"Sending message:\", message);\n\t\t\t// ws.send(JSON.stringify(message));\n\n\t\t\t// Clear the input\n\t\t\tmessageInput.value = '';\n\t\t}\n\t});\n\n\t// Function to append a message to the chat\n\tfunction appendMessageToChat(message) {\n\t\tconst chatRoom = document.getElementById('chat_room');\n\t\tconst noMessagesElement = document.getElementById('noMessages');\n\n\t\t// Remove the \"No messages yet\" message if it exists\n\t\tif (noMessagesElement) {\n\t\t\tnoMessagesElement.remove();\n\t\t}\n\n\t\tconst messageElement = document.createElement('li');\n\t\tmessageElement.classList.add('p-3', 'mt-4', 'rounded-lg', 'shadow', 'max-w-xs');\n\n\t\tif (message.sender_id == currentUserId) {\n\t\t\tmessageElement.classList.add('bg-blue-100', 'text-right', 'justify-end');\n\t\t} else {\n\t\t\tmessageElement.classList.add('bg-gray-100', 'text-left', 'justify-start');\n\t\t}\n\n\t\tmessageElement.innerHTML = `\n      <div class=\"text-sm text-gray-800\">${message.text}</div>\n      <div class=\"text-xs text-gray-500 mt-1\">${new Date(message.created_at).toLocaleString()}</div>\n    `;\n\n\t\tchatRoom.appendChild(messageElement);\n\t\tchatRoom.scrollTop = chatRoom.scrollHeight;\n\t};\n\n</script>
